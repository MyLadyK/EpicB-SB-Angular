<div class="max-w-4xl mx-auto mt-10 bg-white rounded-lg shadow-lg p-8">
  <h2 class="text-2xl font-bold mb-6 text-blue-900">
    <span *ngIf="!autoStarted">Simulación de Batalla</span>
    <span *ngIf="autoStarted">⚔️ Batalla contra {{ opponentName }} ⚔️</span>
  </h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
    <div class="bg-blue-50 rounded-lg p-4 shadow flex flex-col items-center"
         [ngClass]="{
           'ring-4 ring-red-500 animate-pulse': battleInProgress && attackingCharacter === selectedCharacter1,
           'ring-4 ring-blue-500': battleInProgress && defendingCharacter === selectedCharacter1
         }">
      <img [src]="getCharacterImageUrl(getCharacter1())" alt="Personaje 1" class="w-24 h-24 object-cover rounded-full border-2 border-blue-300 mb-2"
           [ngClass]="{
             'border-red-500 border-4': battleInProgress && attackingCharacter === selectedCharacter1,
             'border-blue-500 border-4': battleInProgress && defendingCharacter === selectedCharacter1
           }">
      <p class="font-semibold text-blue-800">{{ getCharacterName(getCharacter1()) }}</p>
      <div class="w-full mt-2">
        <div class="h-4 bg-gray-200 rounded-full">
          <div class="h-4 bg-green-500 rounded-full transition-all duration-500" [style.width]="getHealthBarWidth(getCharacter1())"></div>
        </div>
        <span class="text-xs text-gray-700">Salud: {{ battleInProgress ? currentHealth1 : getCharacterHealth(getCharacter1()) }}</span>
      </div>
    </div>
    <div class="bg-blue-50 rounded-lg p-4 shadow flex flex-col items-center"
         [ngClass]="{
           'ring-4 ring-red-500 animate-pulse': battleInProgress && attackingCharacter === selectedCharacter2,
           'ring-4 ring-blue-500': battleInProgress && defendingCharacter === selectedCharacter2
         }">
      <img [src]="getCharacterImageUrl(getCharacter2())" alt="Personaje 2" class="w-24 h-24 object-cover rounded-full border-2 border-blue-300 mb-2"
           [ngClass]="{
             'border-red-500 border-4': battleInProgress && attackingCharacter === selectedCharacter2,
             'border-blue-500 border-4': battleInProgress && defendingCharacter === selectedCharacter2
           }">
      <p class="font-semibold text-blue-800">{{ getCharacterName(getCharacter2()) }}</p>
      <div class="w-full mt-2">
        <div class="h-4 bg-gray-200 rounded-full">
          <div class="h-4 bg-green-500 rounded-full transition-all duration-500" [style.width]="getHealthBarWidth(getCharacter2())"></div>
        </div>
        <span class="text-xs text-gray-700">Salud: {{ battleInProgress ? currentHealth2 : getCharacterHealth(getCharacter2()) }}</span>
      </div>
    </div>
  </div>

  <div class="flex justify-center mb-6" *ngIf="!autoStarted">
    <button (click)="fight()" [disabled]="loading" class="btn bg-blue-700 text-white font-bold px-6 py-2 rounded shadow hover:bg-blue-900 transition-colors">Iniciar Batalla</button>
  </div>

  <div *ngIf="loading">
    <p>Cargando resumen de batalla...</p>
  </div>
  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="battleResult" class="mt-8">
    <h3 class="text-xl font-bold mb-4 text-blue-900">Desarrollo de la Batalla</h3>
    <div class="bg-blue-50 rounded-lg p-4 shadow mb-4">
      <div *ngFor="let event of battleResult.events; let i = index" class="mb-2 text-gray-800"
           [ngClass]="{'font-bold': i === currentEventIndex - 1, 'opacity-50': !eventAnimations[i]}">
        <span [ngClass]="{
          'font-bold text-red-600': event.includes('crítico'),
          'font-bold text-purple-600': event.includes('especial'),
          'font-bold text-green-600': event.includes('gana'),
          'animate-pulse': i === currentEventIndex - 1 && battleInProgress
        }">
          {{ event }}
        </span>
      </div>

      <!-- Mostrar el resultado final solo cuando la batalla ha terminado -->
      <div *ngIf="!battleInProgress && battleResult" class="mt-4 border-t pt-4 border-gray-300">
        <div class="mt-2">
          <span class="font-semibold text-green-700">{{ battleResult.result }}</span>
        </div>
        <div class="mt-2 text-blue-700">
          <span class="font-semibold">Oponente:</span> {{ battleResult.opponentName }}
        </div>
        <div class="mt-2 text-gray-700">
          <span class="font-semibold">Fecha:</span> {{ battleResult.date }}
        </div>
      </div>
    </div>
  </div>
</div>
